"""
Emotion Music App - Unified Evaluation System
==============================================
‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏£‡∏ö‡∏ß‡∏á‡∏à‡∏£ ‡∏£‡∏ß‡∏° 3 ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£:
1. Basic Evaluation (20 samples)
2. Enhanced with Oversampling (60+ samples)
3. Crowdsourcing with Voting (30 samples)

Usage:
    python evaluation_unified.py --method all          # ‡∏£‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    python evaluation_unified.py --method basic        # ‡∏£‡∏±‡∏ô‡πÅ‡∏ö‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
    python evaluation_unified.py --method oversampling # ‡∏£‡∏±‡∏ô‡πÅ‡∏ö‡∏ö Oversampling
    python evaluation_unified.py --method crowdsourced # ‡∏£‡∏±‡∏ô‡πÅ‡∏ö‡∏ö Crowdsourcing
"""

import sqlite3
import pandas as pd
from sklearn.metrics import (
    accuracy_score, precision_recall_fscore_support,
    confusion_matrix, classification_report
)
from sklearn.utils import resample
import numpy as np
import random
import argparse
from collections import Counter
from emotion_model import detect_emotion, THAI_TO_ENG

# =============================================================================
# GROUND TRUTH DATA - BASIC (20 samples)
# =============================================================================
BASIC_GROUND_TRUTH = [
    ("‡∏â‡∏±‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡πÉ‡∏à‡∏ó‡∏µ‡πà‡πÄ‡∏ò‡∏≠‡∏à‡∏≤‡∏Å‡πÑ‡∏õ ‡πÑ‡∏°‡πà‡∏´‡∏ß‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏°‡∏≤", "sad"),
    ("‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏î‡∏µ‡∏à‡∏±‡∏á ‡∏≠‡∏¢‡∏≤‡∏Å‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡πÄ‡∏î‡∏¥‡∏ô‡πÄ‡∏•‡πà‡∏ô", "happy"),
    ("‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ß‡∏±‡∏á‡∏ß‡πà‡∏≤‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤", "hope"),
    ("‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏±‡∏ß‡∏Ñ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡πÉ‡∏ô‡πÇ‡∏•‡∏Å‡∏Å‡∏ß‡πâ‡∏≤‡∏á", "lonely"),
    ("‡∏ï‡∏∑‡πà‡∏ô‡πÄ‡∏ï‡πâ‡∏ô‡∏à‡∏±‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÑ‡∏î‡πâ‡πÄ‡∏à‡∏≠‡πÄ‡∏ò‡∏≠", "excited"),
    ("‡∏ô‡∏±‡πà‡∏á‡∏°‡∏≠‡∏á‡∏ó‡∏∞‡πÄ‡∏•‡πÄ‡∏á‡∏µ‡∏¢‡∏ö‡πÜ ‡∏™‡∏ö‡∏≤‡∏¢‡πÉ‡∏à", "calm"),
    ("‡∏ó‡∏≥‡πÑ‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏Å‡∏±‡∏ö‡∏â‡∏±‡∏ô‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ ‡πÇ‡∏Å‡∏£‡∏ò‡∏°‡∏≤‡∏Å", "angry"),
    ("‡∏Å‡πá‡πÅ‡∏Ñ‡πà‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏õ‡∏ß‡∏±‡∏ô‡πÜ ‡πÑ‡∏°‡πà‡∏Ñ‡∏¥‡∏î‡∏≠‡∏∞‡πÑ‡∏£", "neutral"),
    ("‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡πÑ‡∏´‡∏•‡πÑ‡∏°‡πà‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏•‡∏¢", "sad"),
    ("‡∏¢‡∏¥‡πâ‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏´‡πá‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ò‡∏≠", "happy"),
    ("‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏ô‡∏∞", "hope"),
    ("‡πÄ‡∏´‡∏á‡∏≤‡∏à‡∏±‡∏ö‡πÉ‡∏à ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏Ñ‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à", "lonely"),
    ("‡∏°‡∏±‡∏ô‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î‡πÑ‡∏õ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏™‡∏¥‡∏£‡πå‡∏ï‡∏ô‡∏µ‡πâ", "excited"),
    ("‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡∏ü‡∏±‡∏á‡πÄ‡∏û‡∏•‡∏á‡πÄ‡∏ö‡∏≤‡πÜ", "calm"),
    ("‡∏≠‡∏¢‡πà‡∏≤‡∏°‡∏≤‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡∏â‡∏±‡∏ô‡πÇ‡∏°‡πÇ‡∏´‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏∞", "angry"),
    ("‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢‡πÜ ‡πÄ‡∏õ‡∏∑‡πà‡∏≠‡∏¢‡πÜ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡∏û‡∏¥‡πÄ‡∏®‡∏©", "neutral"),
    ("‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏à‡∏∞‡πÄ‡∏≠‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏á‡∏Å‡∏±‡∏ö‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï", "sad"),
    ("‡∏£‡∏≠‡∏ô‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏∞ ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏´‡∏£‡πà‡∏à‡∏∞‡∏°‡∏≤", "angry"),
    ("‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°‡∏ï‡∏≤‡∏°‡∏ó‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á", "happy"),
    ("‡πÄ‡∏á‡∏µ‡∏¢‡∏ö‡∏™‡∏á‡∏ö‡∏î‡∏µ‡∏à‡∏±‡∏á", "calm")
]

# =============================================================================
# GROUND TRUTH DATA - EXTENDED (60+ samples for Oversampling)
# =============================================================================
EXTENDED_GROUND_TRUTH = {
    "sad": [
        ("‡∏â‡∏±‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡πÉ‡∏à‡∏ó‡∏µ‡πà‡πÄ‡∏ò‡∏≠‡∏à‡∏≤‡∏Å‡πÑ‡∏õ ‡πÑ‡∏°‡πà‡∏´‡∏ß‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏°‡∏≤", "sad"),
        ("‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡πÑ‡∏´‡∏•‡πÑ‡∏°‡πà‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏•‡∏¢", "sad"),
        ("‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏à‡∏∞‡πÄ‡∏≠‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏á‡∏Å‡∏±‡∏ö‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï ‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏±‡∏ô‡∏´‡∏î‡∏´‡∏π‡πà", "sad"),
        ("‡πÄ‡∏à‡πá‡∏ö‡∏õ‡∏ß‡∏î‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏ò‡∏≠‡πÑ‡∏õ", "sad"),
        ("‡∏´‡∏±‡∏ß‡πÉ‡∏à‡πÅ‡∏´‡∏•‡∏Å‡∏™‡∏•‡∏≤‡∏¢‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏π‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á", "sad"),
        ("‡∏≠‡∏¢‡∏≤‡∏Å‡∏£‡πâ‡∏≠‡∏á‡πÑ‡∏´‡πâ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡∏î‡∏±‡∏á‡πÜ", "sad"),
        ("‡∏ó‡∏∏‡∏Å‡∏Ç‡πå‡∏ó‡∏£‡∏°‡∏≤‡∏ô‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡∏ñ‡∏∂‡∏á", "sad"),
        ("‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏°‡∏±‡∏ô‡∏´‡∏°‡πà‡∏ô‡∏´‡∏°‡∏≠‡∏á‡πÑ‡∏õ‡∏´‡∏°‡∏î", "sad"),
        ("‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏®‡∏£‡πâ‡∏≤‡∏°‡∏±‡∏ô‡∏ó‡πà‡∏ß‡∏°‡∏ó‡πâ‡∏ô‡∏´‡∏±‡∏ß‡πÉ‡∏à", "sad"),
        ("‡∏ú‡∏¥‡∏î‡∏´‡∏ß‡∏±‡∏á‡∏ã‡πâ‡∏≥‡πÅ‡∏•‡πâ‡∏ß‡∏ã‡πâ‡∏≥‡πÄ‡∏•‡πà‡∏≤", "sad"),
    ],
    "happy": [
        ("‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏î‡∏µ‡∏à‡∏±‡∏á ‡∏≠‡∏¢‡∏≤‡∏Å‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡πÄ‡∏î‡∏¥‡∏ô‡πÄ‡∏•‡πà‡∏ô", "happy"),
        ("‡∏¢‡∏¥‡πâ‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏´‡πá‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ò‡∏≠", "happy"),
        ("‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°‡∏ï‡∏≤‡∏°‡∏ó‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏à‡∏±‡∏á", "happy"),
        ("‡πÄ‡∏¢‡πâ! ‡∏™‡∏≠‡∏ö‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡∏î‡∏µ‡πÉ‡∏à‡∏°‡∏≤‡∏Å", "happy"),
        ("‡∏´‡∏±‡∏ß‡πÄ‡∏£‡∏≤‡∏∞‡∏à‡∏ô‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡πÑ‡∏´‡∏• ‡∏™‡∏ô‡∏∏‡∏Å‡∏°‡∏≤‡∏Å", "happy"),
        ("‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏™‡∏î‡πÉ‡∏™‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏™‡∏≤‡∏¢‡∏£‡∏∏‡πâ‡∏á", "happy"),
        ("‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏î‡πâ‡∏ß‡∏¢", "happy"),
        ("‡∏£‡πà‡∏≤‡πÄ‡∏£‡∏¥‡∏á‡∏™‡∏î‡πÉ‡∏™ ‡∏¢‡∏¥‡πâ‡∏°‡∏ï‡∏•‡∏≠‡∏î‡∏ß‡∏±‡∏ô", "happy"),
        ("‡∏õ‡∏•‡∏∑‡πâ‡∏°‡πÉ‡∏à‡∏à‡∏ô‡∏û‡∏π‡∏î‡πÑ‡∏°‡πà‡∏≠‡∏≠‡∏Å", "happy"),
        ("‡πÄ‡∏ö‡∏¥‡∏Å‡∏ö‡∏≤‡∏ô‡πÉ‡∏à‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏à‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏Å‡πà‡∏≤", "happy"),
    ],
    "hope": [
        ("‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ß‡∏±‡∏á‡∏ß‡πà‡∏≤‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤", "hope"),
        ("‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏ô‡∏∞", "hope"),
        ("‡∏™‡∏±‡∏Å‡∏ß‡∏±‡∏ô‡∏ù‡∏±‡∏ô‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏£‡∏¥‡∏á", "hope"),
        ("‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡πÇ‡∏ä‡∏Ñ‡∏î‡∏µ ‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏à‡∏∞‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô", "hope"),
        ("‡∏™‡∏π‡πâ‡πÜ ‡∏ô‡∏∞ ‡∏≠‡∏¢‡πà‡∏≤‡∏¢‡∏≠‡∏°‡πÅ‡∏û‡πâ", "hope"),
        ("‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏≠‡∏µ‡∏Å‡∏ô‡∏¥‡∏î ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏£‡∏≠‡πÄ‡∏£‡∏≤‡∏≠‡∏¢‡∏π‡πà", "hope"),
        ("‡∏®‡∏£‡∏±‡∏ó‡∏ò‡∏≤‡πÉ‡∏ô‡∏û‡∏•‡∏±‡∏á‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á", "hope"),
        ("‡πÅ‡∏™‡∏á‡∏™‡∏ß‡πà‡∏≤‡∏á‡∏£‡∏≠‡∏≠‡∏¢‡∏π‡πà‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á", "hope"),
    ],
    "lonely": [
        ("‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏±‡∏ß‡∏Ñ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡πÉ‡∏ô‡πÇ‡∏•‡∏Å‡∏Å‡∏ß‡πâ‡∏≤‡∏á", "lonely"),
        ("‡πÄ‡∏´‡∏á‡∏≤‡∏à‡∏±‡∏ö‡πÉ‡∏à ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏Ñ‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à", "lonely"),
        ("‡∏Ñ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏≠‡∏µ‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏Ñ‡∏£‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡πâ‡∏≤‡∏á‡πÜ", "lonely"),
        ("‡∏ß‡πâ‡∏≤‡πÄ‡∏´‡∏ß‡πà‡∏à‡∏±‡∏á ‡∏≠‡∏¢‡∏≤‡∏Å‡∏°‡∏µ‡∏Ñ‡∏ô‡∏Ñ‡∏∏‡∏¢‡∏î‡πâ‡∏ß‡∏¢", "lonely"),
        ("‡πÇ‡∏î‡∏î‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß‡∏ó‡πà‡∏≤‡∏°‡∏Å‡∏•‡∏≤‡∏á‡∏ù‡∏π‡∏á‡∏ä‡∏ô", "lonely"),
        ("‡∏Ñ‡∏¥‡∏î‡∏ñ‡∏∂‡∏á‡πÄ‡∏ò‡∏≠‡∏à‡∏ô‡∏ô‡∏≠‡∏ô‡πÑ‡∏°‡πà‡∏´‡∏•‡∏±‡∏ö", "lonely"),
        ("‡∏•‡∏≥‡∏û‡∏±‡∏á‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏°‡∏∑‡∏î", "lonely"),
        ("‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏ï‡πá‡∏°", "lonely"),
    ],
    "excited": [
        ("‡∏ï‡∏∑‡πà‡∏ô‡πÄ‡∏ï‡πâ‡∏ô‡∏à‡∏±‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÑ‡∏î‡πâ‡πÄ‡∏à‡∏≠‡πÄ‡∏ò‡∏≠", "excited"),
        ("‡∏°‡∏±‡∏ô‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î‡πÑ‡∏õ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏™‡∏¥‡∏£‡πå‡∏ï‡∏ô‡∏µ‡πâ", "excited"),
        ("‡∏û‡∏µ‡∏Ñ‡∏°‡∏≤‡∏Å ‡∏£‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏´‡∏ß‡πÅ‡∏•‡πâ‡∏ß", "excited"),
        ("‡∏Æ‡∏∂‡∏Å‡πÄ‡∏´‡∏¥‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏•‡∏∏‡∏¢", "excited"),
        ("‡∏£‡∏∞‡∏ó‡∏∂‡∏Å‡πÉ‡∏à‡∏™‡∏∏‡∏î‡πÜ", "excited"),
        ("‡∏£‡πâ‡∏≠‡∏ô‡πÅ‡∏£‡∏á‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÑ‡∏ü", "excited"),
    ],
    "calm": [
        ("‡∏ô‡∏±‡πà‡∏á‡∏°‡∏≠‡∏á‡∏ó‡∏∞‡πÄ‡∏•‡πÄ‡∏á‡∏µ‡∏¢‡∏ö‡πÜ ‡∏™‡∏ö‡∏≤‡∏¢‡πÉ‡∏à", "calm"),
        ("‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡∏ü‡∏±‡∏á‡πÄ‡∏û‡∏•‡∏á‡πÄ‡∏ö‡∏≤‡πÜ", "calm"),
        ("‡πÄ‡∏á‡∏µ‡∏¢‡∏ö‡∏™‡∏á‡∏ö‡∏î‡∏µ‡∏à‡∏±‡∏á", "calm"),
        ("‡∏ú‡πà‡∏≠‡∏ô‡∏Ñ‡∏•‡∏≤‡∏¢‡∏£‡∏¥‡∏°‡∏ä‡∏≤‡∏¢‡∏´‡∏≤‡∏î", "calm"),
        ("‡πÉ‡∏à‡πÄ‡∏¢‡πá‡∏ô‡πÜ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏µ‡∏ö", "calm"),
        ("‡∏ä‡∏¥‡∏•‡πÜ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏á‡∏ß‡∏•", "calm"),
    ],
    "angry": [
        ("‡∏ó‡∏≥‡πÑ‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏Å‡∏±‡∏ö‡∏â‡∏±‡∏ô‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ ‡πÇ‡∏Å‡∏£‡∏ò‡∏°‡∏≤‡∏Å", "angry"),
        ("‡∏≠‡∏¢‡πà‡∏≤‡∏°‡∏≤‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡∏â‡∏±‡∏ô ‡πÇ‡∏°‡πÇ‡∏´‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏∞", "angry"),
        ("‡∏£‡∏≠‡∏ô‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏∞ ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏´‡∏£‡πà‡∏à‡∏∞‡∏°‡∏≤‡∏™‡∏±‡∏Å‡∏ó‡∏µ", "angry"),
        ("‡πÄ‡∏î‡∏∑‡∏≠‡∏î‡∏°‡∏≤‡∏Å ‡∏ó‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏´‡∏ß‡πÅ‡∏•‡πâ‡∏ß", "angry"),
        ("‡πÅ‡∏Ñ‡πâ‡∏ô‡πÉ‡∏à‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏´‡∏•‡∏≠‡∏Å", "angry"),
        ("‡πÄ‡∏Å‡∏•‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏Å‡∏´‡∏Å", "angry"),
    ],
    "neutral": [
        ("‡∏Å‡πá‡πÅ‡∏Ñ‡πà‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏õ‡∏ß‡∏±‡∏ô‡πÜ ‡πÑ‡∏°‡πà‡∏Ñ‡∏¥‡∏î‡∏≠‡∏∞‡πÑ‡∏£", "neutral"),
        ("‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢‡πÜ ‡πÄ‡∏õ‡∏∑‡πà‡∏≠‡∏¢‡πÜ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡∏û‡∏¥‡πÄ‡∏®‡∏©", "neutral"),
        ("‡∏õ‡∏Å‡∏ï‡∏¥‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡πÅ‡∏õ‡∏•‡∏Å", "neutral"),
        ("‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ ‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏≠‡∏∞‡πÑ‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©", "neutral"),
        ("‡πÄ‡∏â‡∏¢‡πÜ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å", "neutral"),
        ("‡∏Å‡∏•‡∏≤‡∏á‡πÜ ‡πÑ‡∏°‡πà‡∏™‡∏∏‡∏Ç‡πÑ‡∏°‡πà‡∏ó‡∏∏‡∏Å‡∏Ç‡πå", "neutral"),
    ],
}

# =============================================================================
# CROWDSOURCED VOTES (30 samples with 10 votes each)
# =============================================================================
CROWDSOURCED_VOTES = [
    ("‡∏â‡∏±‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡πÉ‡∏à‡∏ó‡∏µ‡πà‡πÄ‡∏ò‡∏≠‡∏à‡∏≤‡∏Å‡πÑ‡∏õ ‡πÑ‡∏°‡πà‡∏´‡∏ß‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏°‡∏≤", ["sad"]*9 + ["lonely"]),
    ("‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡πÑ‡∏´‡∏•‡πÑ‡∏°‡πà‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏•‡∏¢", ["sad"]*10),
    ("‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏à‡∏∞‡πÄ‡∏≠‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏á‡∏Å‡∏±‡∏ö‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï ‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏±‡∏ô‡∏´‡∏î‡∏´‡∏π‡πà", ["sad"]*8 + ["neutral"]*2),
    ("‡πÄ‡∏à‡πá‡∏ö‡∏õ‡∏ß‡∏î‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏ò‡∏≠‡πÑ‡∏õ", ["sad"]*9 + ["angry"]),
    ("‡∏´‡∏±‡∏ß‡πÉ‡∏à‡πÅ‡∏´‡∏•‡∏Å‡∏™‡∏•‡∏≤‡∏¢‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏π‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á", ["sad"]*9 + ["angry"]),
    ("‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏î‡∏µ‡∏à‡∏±‡∏á ‡∏≠‡∏¢‡∏≤‡∏Å‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡πÄ‡∏î‡∏¥‡∏ô‡πÄ‡∏•‡πà‡∏ô", ["happy"]*9 + ["calm"]),
    ("‡∏¢‡∏¥‡πâ‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏´‡πá‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ò‡∏≠", ["happy"]*10),
    ("‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°‡∏ï‡∏≤‡∏°‡∏ó‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏à‡∏±‡∏á", ["happy"]*9 + ["excited"]),
    ("‡πÄ‡∏¢‡πâ! ‡∏™‡∏≠‡∏ö‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡∏î‡∏µ‡πÉ‡∏à‡∏°‡∏≤‡∏Å", ["happy"]*8 + ["excited"]*2),
    ("‡∏´‡∏±‡∏ß‡πÄ‡∏£‡∏≤‡∏∞‡∏à‡∏ô‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡πÑ‡∏´‡∏• ‡∏™‡∏ô‡∏∏‡∏Å‡∏°‡∏≤‡∏Å", ["happy"]*8 + ["excited"]*2),
    ("‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ß‡∏±‡∏á‡∏ß‡πà‡∏≤‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤", ["hope"]*9 + ["happy"]),
    ("‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏ô‡∏∞", ["hope"]*9 + ["happy"]),
    ("‡∏™‡∏±‡∏Å‡∏ß‡∏±‡∏ô‡∏ù‡∏±‡∏ô‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏£‡∏¥‡∏á", ["hope"]*9 + ["happy"]),
    ("‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡πÇ‡∏ä‡∏Ñ‡∏î‡∏µ ‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏à‡∏∞‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô", ["hope"]*9 + ["happy"]),
    ("‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏±‡∏ß‡∏Ñ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡πÉ‡∏ô‡πÇ‡∏•‡∏Å‡∏Å‡∏ß‡πâ‡∏≤‡∏á", ["lonely"]*9 + ["sad"]),
    ("‡πÄ‡∏´‡∏á‡∏≤‡∏à‡∏±‡∏ö‡πÉ‡∏à ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏Ñ‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à", ["lonely"]*9 + ["sad"]),
    ("‡∏Ñ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏≠‡∏µ‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏Ñ‡∏£‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡πâ‡∏≤‡∏á‡πÜ", ["lonely"]*9 + ["sad"]),
    ("‡∏ß‡πâ‡∏≤‡πÄ‡∏´‡∏ß‡πà‡∏à‡∏±‡∏á ‡∏≠‡∏¢‡∏≤‡∏Å‡∏°‡∏µ‡∏Ñ‡∏ô‡∏Ñ‡∏∏‡∏¢‡∏î‡πâ‡∏ß‡∏¢", ["lonely"]*9 + ["neutral"]),
    ("‡∏ï‡∏∑‡πà‡∏ô‡πÄ‡∏ï‡πâ‡∏ô‡∏à‡∏±‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÑ‡∏î‡πâ‡πÄ‡∏à‡∏≠‡πÄ‡∏ò‡∏≠", ["excited"]*9 + ["happy"]),
    ("‡∏°‡∏±‡∏ô‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î‡πÑ‡∏õ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏™‡∏¥‡∏£‡πå‡∏ï‡∏ô‡∏µ‡πâ", ["excited"]*9 + ["happy"]),
    ("‡∏û‡∏µ‡∏Ñ‡∏°‡∏≤‡∏Å ‡∏£‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏´‡∏ß‡πÅ‡∏•‡πâ‡∏ß", ["excited"]*9 + ["happy"]),
    ("‡∏ô‡∏±‡πà‡∏á‡∏°‡∏≠‡∏á‡∏ó‡∏∞‡πÄ‡∏•‡πÄ‡∏á‡∏µ‡∏¢‡∏ö‡πÜ ‡∏™‡∏ö‡∏≤‡∏¢‡πÉ‡∏à", ["calm"]*9 + ["happy"]),
    ("‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡∏ü‡∏±‡∏á‡πÄ‡∏û‡∏•‡∏á‡πÄ‡∏ö‡∏≤‡πÜ", ["calm"]*9 + ["happy"]),
    ("‡πÄ‡∏á‡∏µ‡∏¢‡∏ö‡∏™‡∏á‡∏ö‡∏î‡∏µ‡∏à‡∏±‡∏á", ["calm"]*9 + ["neutral"]),
    ("‡∏ó‡∏≥‡πÑ‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏Å‡∏±‡∏ö‡∏â‡∏±‡∏ô‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ ‡πÇ‡∏Å‡∏£‡∏ò‡∏°‡∏≤‡∏Å", ["angry"]*9 + ["sad"]),
    ("‡∏≠‡∏¢‡πà‡∏≤‡∏°‡∏≤‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡∏â‡∏±‡∏ô ‡πÇ‡∏°‡πÇ‡∏´‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏∞", ["angry"]*10),
    ("‡∏£‡∏≠‡∏ô‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏∞ ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏´‡∏£‡πà‡∏à‡∏∞‡∏°‡∏≤‡∏™‡∏±‡∏Å‡∏ó‡∏µ", ["angry"]*9 + ["neutral"]),
    ("‡∏Å‡πá‡πÅ‡∏Ñ‡πà‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏õ‡∏ß‡∏±‡∏ô‡πÜ ‡πÑ‡∏°‡πà‡∏Ñ‡∏¥‡∏î‡∏≠‡∏∞‡πÑ‡∏£", ["neutral"]*9 + ["calm"]),
    ("‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢‡πÜ ‡πÄ‡∏õ‡∏∑‡πà‡∏≠‡∏¢‡πÜ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡∏û‡∏¥‡πÄ‡∏®‡∏©", ["neutral"]*9 + ["sad"]),
    ("‡∏õ‡∏Å‡∏ï‡∏¥‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡πÅ‡∏õ‡∏•‡∏Å", ["neutral"]*9 + ["calm"]),
]


# =============================================================================
# UTILITY FUNCTIONS
# =============================================================================
def random_baseline(text):
    """Random guess"""
    emotions = ["sad", "happy", "hope", "lonely", "excited", "calm", "angry", "neutral"]
    return random.choice(emotions)


def lexicon_baseline(text):
    """Simple Lexicon lookup"""
    from pythainlp import word_tokenize
    tokens = word_tokenize(text)
    for w in tokens:
        if w in THAI_TO_ENG:
            return THAI_TO_ENG[w]
    return "neutral"


def calculate_majority_vote(votes):
    """Calculate majority voting and agreement rate"""
    vote_counts = Counter(votes)
    majority_label = vote_counts.most_common(1)[0][0]
    majority_count = vote_counts.most_common(1)[0][1]
    agreement_rate = majority_count / len(votes) * 100
    return majority_label, agreement_rate, vote_counts


def create_balanced_dataset(data_dict):
    """Create balanced dataset using oversampling"""
    max_count = max(len(samples) for samples in data_dict.values())
    balanced_data = []
    
    for emotion, samples in data_dict.items():
        if len(samples) < max_count:
            oversampled = resample(samples, replace=True, n_samples=max_count, random_state=42)
            balanced_data.extend(oversampled)
        else:
            balanced_data.extend(samples)
    
    return balanced_data


def evaluate_model(ground_truth, method_name=""):
    """Generic evaluation function"""
    print(f"\n{'='*70}")
    print(f"üìä EVALUATION: {method_name}")
    print(f"{'='*70}")
    print(f"Dataset size: {len(ground_truth)} samples\n")
    
    models = {
        "BART (Ours)": lambda t: detect_emotion(t, threshold=0.55),
        "Lexicon-based": lexicon_baseline,
        "Random Baseline": random_baseline
    }
    
    results = {}
    for name, predictor in models.items():
        y_true = [label for text, label in ground_truth]
        y_pred = [predictor(text) for text, label in ground_truth]
        
        acc = accuracy_score(y_true, y_pred)
        p, r, f1, _ = precision_recall_fscore_support(y_true, y_pred, average='weighted', zero_division=0)
        results[name] = {"Accuracy": acc, "Precision": p, "Recall": r, "F1": f1}
    
    # Print results
    print(f"{'Model':<20} | {'Accuracy':>10} | {'Precision':>10} | {'Recall':>10} | {'F1-Score':>10}")
    print("-" * 70)
    for name, m in results.items():
        print(f"{name:<20} | {m['Accuracy']:>10.1%} | {m['Precision']:>10.1%} | {m['Recall']:>10.1%} | {m['F1']:>10.1%}")
    
    # Detailed report for BART
    print(f"\nüìã Detailed Report (BART):")
    y_true = [label for text, label in ground_truth]
    y_pred = [detect_emotion(text, threshold=0.55) for text, label in ground_truth]
    print(classification_report(y_true, y_pred, zero_division=0))
    
    # Neutral Bias
    neutral_count = y_pred.count('neutral')
    print(f"üß† Neutral Bias: {neutral_count}/{len(y_pred)} ({neutral_count/len(y_pred)*100:.1f}%)")
    
    return results


# =============================================================================
# EVALUATION METHODS
# =============================================================================
def evaluate_basic():
    """Method 1: Basic Evaluation"""
    print("\n" + "üéØ METHOD 1: BASIC EVALUATION (Expert-annotated)" + "\n")
    return evaluate_model(BASIC_GROUND_TRUTH, "Basic Evaluation (20 samples)")


def evaluate_oversampling():
    """Method 2: Enhanced with Oversampling"""
    print("\n" + "üéØ METHOD 2: ENHANCED WITH OVERSAMPLING" + "\n")
    
    # Original (Imbalanced)
    original_data = []
    for emotion, samples in EXTENDED_GROUND_TRUTH.items():
        original_data.extend(samples)
    
    print(f"Original dataset: {len(original_data)} samples (imbalanced)")
    
    # Balanced (Oversampled)
    balanced_data = create_balanced_dataset(EXTENDED_GROUND_TRUTH)
    print(f"Balanced dataset: {len(balanced_data)} samples (oversampled)\n")
    
    return evaluate_model(balanced_data, "Oversampling (80 samples)")


def evaluate_crowdsourced():
    """Method 3: Crowdsourcing Evaluation"""
    print("\n" + "üéØ METHOD 3: CROWDSOURCING EVALUATION" + "\n")
    
    # Calculate Ground Truth from votes
    ground_truth = []
    agreement_rates = []
    
    for text, votes in CROWDSOURCED_VOTES:
        majority, agreement, _ = calculate_majority_vote(votes)
        ground_truth.append((text, majority))
        agreement_rates.append(agreement)
    
    avg_agreement = np.mean(agreement_rates)
    print(f"Average Agreement Rate: {avg_agreement:.1f}%")
    print(f"Votes per sample: 10 workers\n")
    
    return evaluate_model(ground_truth, "Crowdsourcing (30 samples)")


# =============================================================================
# MAIN
# =============================================================================
def main():
    parser = argparse.ArgumentParser(description="Unified Evaluation System")
    parser.add_argument('--method', type=str, default='all',
                        choices=['all', 'basic', 'oversampling', 'crowdsourced'],
                        help='Evaluation method to run')
    args = parser.parse_args()
    
    print("="*70)
    print("üöÄ EMOTION MUSIC APP - UNIFIED EVALUATION SYSTEM")
    print("="*70)
    
    if args.method == 'all' or args.method == 'basic':
        evaluate_basic()
    
    if args.method == 'all' or args.method == 'oversampling':
        evaluate_oversampling()
    
    if args.method == 'all' or args.method == 'crowdsourced':
        evaluate_crowdsourced()
    
    print("\n" + "="*70)
    print("‚úÖ EVALUATION COMPLETED")
    print("="*70)


if __name__ == "__main__":
    main()
