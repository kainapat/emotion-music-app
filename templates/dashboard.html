{% extends "layout.html" %}
{% block title %}‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î - Emotion Path{% endblock %}
{% block content %}

<h2 class="text-xl font-semibold mb-6">üìà ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</h2>

<!-- ‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -->
<div class="grid grid-cols-4 gap-6 mb-6">
  <div class="bg-white p-4 rounded-xl shadow">
    <p class="text-gray-500">‡πÄ‡∏û‡∏•‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
    <p class="text-2xl font-bold text-pink-600">{{ stats.total_songs }}</p>
  </div>
  <div class="bg-white p-4 rounded-xl shadow">
    <p class="text-gray-500">‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
    <p class="text-2xl font-bold text-purple-600">{{ stats.total_segments }}</p>
  </div>
  <div class="bg-white p-4 rounded-xl shadow">
    <p class="text-gray-500">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</p>
    <p class="text-2xl font-bold text-indigo-600">{{ stats.avg_score }}</p>
  </div>
  <div class="bg-white p-4 rounded-xl shadow">
    <p class="text-gray-500">‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°</p>
    <p class="text-2xl font-bold text-green-600">{{ stats.popular_emotion }}</p>
  </div>
</div>

<!-- ‡∏Å‡∏£‡∏≤‡∏ü -->
<div class="grid grid-cols-2 gap-6">
  <div class="bg-white rounded-xl shadow p-6">
    <h3 class="font-semibold mb-4">‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå</h3>
    <canvas id="pieChart"></canvas>
  </div>
  <div class="bg-white rounded-xl shadow p-6">
    <h3 class="font-semibold mb-4">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå</h3>
    <canvas id="barChart"></canvas>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const emotions = {{ stats.emotion_stats | map(attribute=0) | list | tojson | safe }};
  const counts = {{ stats.emotion_stats | map(attribute=1) | list | tojson | safe }};
  
  console.log("Emotions:", emotions);
  console.log("Counts:", counts);

  // Pie Chart
  new Chart(document.getElementById("pieChart"), {
    type: "pie",
    data: {
      labels: emotions,
      datasets: [{
        data: counts,
        backgroundColor: ["#f87171","#fb923c","#facc15","#4ade80","#60a5fa","#a78bfa","#f472b6"]
      }]
    }
  });

  // Bar Chart
  new Chart(document.getElementById("barChart"), {
    type: "bar",
    data: {
      labels: emotions,
      datasets: [{
        label: "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô",
        data: counts,
        backgroundColor: "#6366f1"
      }]
    },
    options: {
      scales: { y: { beginAtZero: true } }
    }
  });
</script>

{% endblock %}
