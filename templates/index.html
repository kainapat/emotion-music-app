{% extends "layout.html" %}
{% block title %}‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏û‡∏•‡∏á - Emotion Path{% endblock %}
{% block content %}

<!-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏•‡∏á‡πÉ‡∏´‡∏°‡πà -->
<div class="bg-white rounded-xl shadow p-6 mb-6">
  <h2 class="text-xl font-semibold mb-4">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏•‡∏á‡πÉ‡∏´‡∏°‡πà</h2>
  {% if error %}
    <div class="bg-red-100 text-red-700 p-3 rounded mb-4">
      {{ error }}
    </div>
  {% endif %}
  <form method="post" class="grid grid-cols-2 gap-4">
    <input name="youtube" placeholder="‡∏•‡∏¥‡∏á‡∏Å‡πå YouTube" class="border p-2 rounded col-span-2">
    <textarea name="lyrics" id="lyrics" placeholder="‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡πÄ‡∏û‡∏•‡∏á" class="border p-2 rounded col-span-2 font-mono"></textarea>
    <div class="col-span-2 flex justify-end gap-2">
      <button type="button" onclick="tokenizeLyrics()" 
              class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
        üîÑ ‡πÅ‡∏ö‡πà‡∏á‡∏Ñ‡∏≥‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
      </button>
      <button type="submit"
              class="bg-gradient-to-r from-pink-500 to-purple-500 text-white px-4 py-2 rounded">
        üìä ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå
      </button>
    </div>
  </form>

  <script>
    async function tokenizeLyrics() {
      const textarea = document.getElementById('lyrics');
      const lyrics = textarea.value;
      
      if (!lyrics.trim()) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡πÄ‡∏û‡∏•‡∏á‡∏Å‡πà‡∏≠‡∏ô');
        return;
      }

      try {
        const response = await fetch('/tokenize', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ lyrics: lyrics })
        });

        if (response.ok) {
          const result = await response.json();
          textarea.value = result.tokenized_text;
        } else {
          alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡πà‡∏á‡∏Ñ‡∏≥');
        }
      } catch (error) {
        alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠');
      }
    }
  </script>
</div>

<!-- ‡πÄ‡∏û‡∏•‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î -->
<h2 class="text-xl font-semibold mb-4">üéµ ‡πÄ‡∏û‡∏•‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
  {% for song in songs %}
  <div class="bg-white p-4 rounded-lg shadow hover:shadow-lg transition-shadow">
    <!-- ‡∏™‡∏£‡∏∏‡∏õ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡πÅ‡∏ö‡∏ö‡∏¢‡πà‡∏≠ -->
    <div class="mb-3 p-2 rounded-lg border {{ song.emotion_color }}">
      <div class="flex items-center space-x-2">
        <span class="text-lg">{{ song.emotion_icon }}</span>
        <span class="text-sm font-semibold uppercase">{{ song.overall_emotion }}</span>
      </div>
    </div>
    
    <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏•‡∏á -->
    <p class="font-bold text-lg mb-2">
      <a href="/song/{{ song.id }}" class="text-blue-600 hover:underline">
        {{ song.title }}
      </a>
    </p>
    <p class="text-sm text-gray-500 mb-3">üëÅ {{ song.views }} üëç {{ song.likes }} üìÖ {{ song.upload }}</p>
    
    <!-- ‡∏Å‡∏£‡∏≤‡∏ü -->
    {% if song.graph %}
    <div class="mb-3">
      {{ song.graph|safe }}
    </div>
    {% endif %}
    
    <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö -->
    <form action="/song/{{ song.id }}/delete" method="post"
          onsubmit="return confirm('‚ùå ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÄ‡∏û‡∏•‡∏á {{ song.title }} ‡∏à‡∏£‡∏¥‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?');">
      <button type="submit"
              class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 text-sm">
        üóëÔ∏è ‡∏•‡∏ö
      </button>
    </form>
  </div>
  {% endfor %}
</div>
{% endblock %}
